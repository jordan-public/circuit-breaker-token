jordan@p21 circuit-breaker-token % ./deployCitreaTestnet.sh 
[⠊] Compiling...
No files changed, compilation skipped
Script ran successfully.

== Logs ==
  === CIRCUIT BREAKER TOKEN DEPLOYMENT ===
  
  1. Deploying Mock WBTC (underlying asset)...
     WBTC deployed at: 0xE71C57852392123BbE527A16271D2E6395c66e8b
  
  2. Deploying Sample Lending Protocol (placeholder)...
     Protocol placeholder deployed at: 0x9112Fb7407f1E4818Cc394644E6165a74e5652A2
  
  3. Deploying Circuit Breaker Token (cWBTC)...
     Cooldown blocks: 5
     Liquidation window: 5
     cWBTC deployed at: 0xD457436EBD456774E44F1Fa468D1D7423cFD9ddE
  
  4. Deploying Actual Lending Protocol...
     LendingProtocol deployed at: 0x38288e03211FD049d9A10eC72333d121EBDa8178
  
  === SETUP PHASE ===
  
  5. Setting up test users (Alice and Bob)...
     Minted 100 WBTC to Alice: 0x00000000000000000000000000000000000A11cE
     Minted 100 WBTC to Bob: 0x0000000000000000000000000000000000000B0b
     Alice deposited 50 WBTC, received 50 cWBTC
     Alice's remaining wallet: 50 WBTC (insufficient for full collateral)
     Alice deposited 50 cWBTC as collateral in protocol
     Alice's health factor set to 80% (UNHEALTHY - can be liquidated)
  
     Bob deposited 80 WBTC, received 80 cWBTC
     Bob's remaining wallet: 20 WBTC (insufficient for full collateral)
     Bob deposited 80 cWBTC as collateral in protocol
     Bob's health factor set to 90% (UNHEALTHY - can be liquidated)
  
  === LIQUIDATION DEMONSTRATION ===
  
  6. Initiating liquidation for Alice (insufficient wallet balance)...
     Liquidation initiated at block: 18518508
     Cooldown ends at block: 18518513
     Window ends at block: 18518518
  
  7. Simulating progressive liquidation window for Alice...
     Alice's wallet balance (50 WBTC) < collateral (50 cWBTC)
     Wallet/Collateral ratio: 100% -> Gets 50% cap initially
     BUT cap decays to 100% over the window
  
     Block (cooldown): 18518509
       Percentage: 0
     Block (cooldown): 18518510
       Percentage: 0
     Block (cooldown): 18518511
       Percentage: 0
     Block (cooldown): 18518512
       Percentage: 0
     Block (cooldown): 18518513
       Percentage: 10
  
     Cooldown complete! Liquidation window begins:
  
     Block: 18518513
       Liquidatable %: 10
       Amount (cWBTC): 0
     Block: 18518514
       Liquidatable %: 28
       Amount (cWBTC): 0
     Block: 18518515
       Liquidatable %: 46
       Amount (cWBTC): 0
     Block: 18518516
       Liquidatable %: 64
       Amount (cWBTC): 0
     Block: 18518517
       Liquidatable %: 82
       Amount (cWBTC): 0
     Block: 18518518
       Liquidatable %: 100
       Amount (cWBTC): 0
  
  8. Initiating liquidation for Bob (has wallet balance)...
     Liquidation initiated at block: 18518518
  
  9. Simulating progressive liquidation window for Bob...
     Bob's wallet balance (20 WBTC) < collateral (80 cWBTC)
     Wallet/Collateral ratio: 25% -> No cap protection (< 50% threshold)
  
     Block (cooldown): 18518519
       Percentage: 0
     Block (cooldown): 18518520
       Percentage: 0
     Block (cooldown): 18518521
       Percentage: 0
     Block (cooldown): 18518522
       Percentage: 0
     Block (cooldown): 18518523
       Percentage: 10
  
     Cooldown complete! Liquidation window begins:
  
     Block: 18518523
       Liquidatable %: 10
       Amount (cWBTC): 0
     Block: 18518524
       Liquidatable %: 28
       Amount (cWBTC): 0
     Block: 18518525
       Liquidatable %: 46
       Amount (cWBTC): 0
     Block: 18518526
       Liquidatable %: 64
       Amount (cWBTC): 0
     Block: 18518527
       Liquidatable %: 82
       Amount (cWBTC): 0
     Block: 18518528
       Liquidatable %: 100
       Amount (cWBTC): 0
  
  === DEPLOYMENT COMPLETE ===
  
  Deployed Contracts:
    WBTC (Mock): 0xE71C57852392123BbE527A16271D2E6395c66e8b
    cWBTC (Circuit Breaker): 0xD457436EBD456774E44F1Fa468D1D7423cFD9ddE
    LendingProtocol: 0x38288e03211FD049d9A10eC72333d121EBDa8178
  
  Key Observations:
    1. Progressive liquidation grows from 10% to max allowed over 5 blocks
    2. Users with wallet balance get protection caps that decay over time
    3. Alice (100% ratio) starts at 50% cap, decays to 100%
    4. Bob (25% ratio) has no cap - normal progressive curve
    5. This mechanism balances user protection with protocol solvency
  

## Setting up 1 EVM.

==========================

Chain 5115

Estimated gas price: 0.0020001 gwei

Estimated total gas used for script: 3749149

Estimated amount required: 0.0000074986729149 ETH

==========================

##### 5115
✅  [Success] Hash: 0x4b0f8b84d4107308902b9cdc8afd901c9d74e6cb1a623a12fa31514cba501862
Contract Address: 0x9112Fb7407f1E4818Cc394644E6165a74e5652A2
Block: 18518512
Paid: 0.0000003477637729 ETH (347729 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xb71592b5adcc806c17b65bf62c2b661c2d50ed67dcf9f432154cb58a54847925
Block: 18518512
Paid: 0.0000000439593955 ETH (43955 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0x0b763fef41571f77baceca965c78d413a56aeaaca52a21759b96d7487368c38c
Block: 18518512
Paid: 0.0000000814341426 ETH (81426 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0x8406f8c5930833741613f607b9cca0d3175bbe4f3852d5157cce9e237becdff0
Block: 18518512
Paid: 0.0000000511291124 ETH (51124 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0x9e405c4df28819771625b0b53092a23bf3f35eac1c904d00a298abff7c56e7a8
Block: 18518512
Paid: 0.0000000814221414 ETH (81414 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xe60ea2142e492c4aab591abd346c8e9ca68316fec4acc7960ef902a0c65e7c9d
Contract Address: 0xE71C57852392123BbE527A16271D2E6395c66e8b
Block: 18518512
Paid: 0.0000005659645908 ETH (565908 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xa5c8e011d9809dbd673fa40330f7f1973bbd16a6574f64d1d205c42a9f373556
Contract Address: 0xD457436EBD456774E44F1Fa468D1D7423cFD9ddE
Block: 18518512
Paid: 0.0000012396259502 ETH (1239502 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xa9e9ed0020f446cc1d4d2b578f1703b35982ab91389757256d93448f7bfe681b
Block: 18518512
Paid: 0.0000000511171112 ETH (51112 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xdd7f6af07d4e8bdac756ab019e23f34be319984d32258688809aeb1629b089b2
Contract Address: 0x38288e03211FD049d9A10eC72333d121EBDa8178
Block: 18518512
Paid: 0.0000003479917957 ETH (347957 gas * 0.0010001 gwei)


##### 5115
✅  [Success] Hash: 0xac95a1ae3f4296e2f6e7d98abafd3496e592edd34281e14aa2124e9623b0f1ee
Block: 18518512
Paid: 0.0000000439473943 ETH (43943 gas * 0.0010001 gwei)

✅ Sequence #1 on 5115 | Total Paid: 0.000002854355407 ETH (2854070 gas * avg 0.0010001 gwei)
                                                                                                  

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.

Transactions saved to: /Users/jordan/circuit-breaker-token/broadcast/CircuitBreakerToken.s.sol/5115/run-latest.json

Sensitive values saved to: /Users/jordan/circuit-breaker-token/cache/CircuitBreakerToken.s.sol/5115/run-latest.json
