== Logs ==
  === CIRCUIT BREAKER TOKEN DEPLOYMENT ===
  
  1. Deploying Mock WBTC (underlying asset)...
     WBTC deployed at: 0x81a2e35Ce5730Fc0B10730A6Ecd0f890CB20012F
  
  2. Deploying Sample Lending Protocol (placeholder)...
     Protocol placeholder deployed at: 0x5254605C60AfB2D77cbfA35E0De60467ce622BB8
  
  3. Deploying Circuit Breaker Token (cWBTC)...
     Cooldown blocks: 15
     Liquidation window: 15
     cWBTC deployed at: 0x0888091227379c6e5719859F7A39024edA454E20
  
  4. Deploying Actual Lending Protocol...
     LendingProtocol deployed at: 0xE28C059f74e0044C01bD06e9B0A2642D5d1717e6
  
  === SETUP PHASE ===
  
  5. Setting up test users (Alice and Bob)...
     Minted 100 WBTC to Alice: 0x00000000000000000000000000000000000A11cE
     Minted 100 WBTC to Bob: 0x0000000000000000000000000000000000000B0b
     Alice deposited 50 WBTC, received 50 cWBTC
     Alice's remaining wallet: 50 WBTC (insufficient for full collateral)
     Alice deposited 50 cWBTC as collateral in protocol
     Alice's health factor set to 80% (UNHEALTHY - can be liquidated)
  
     Bob deposited 80 WBTC, received 80 cWBTC
     Bob's remaining wallet: 20 WBTC (insufficient for full collateral)
     Bob deposited 80 cWBTC as collateral in protocol
     Bob's health factor set to 90% (UNHEALTHY - can be liquidated)
  
  === LIQUIDATION DEMONSTRATION ===
  
  6. Initiating liquidation for Alice (insufficient wallet balance)...
     Liquidation initiated at block: 7058551
     Cooldown ends at block: 7058566
     Window ends at block: 7058581
  
  7. Simulating progressive liquidation window for Alice...
     Alice's wallet balance (50 WBTC) < collateral (50 cWBTC)
     Wallet/Collateral ratio: 100% -> Gets 50% cap initially
     BUT cap decays to 100% over the window
  
     Block (cooldown): 7058552
       Percentage: 0
     Block (cooldown): 7058553
       Percentage: 0
     Block (cooldown): 7058554
       Percentage: 0
     Block (cooldown): 7058555
       Percentage: 0
     Block (cooldown): 7058556
       Percentage: 0
     Block (cooldown): 7058557
       Percentage: 0
     Block (cooldown): 7058558
       Percentage: 0
     Block (cooldown): 7058559
       Percentage: 0
     Block (cooldown): 7058560
       Percentage: 0
     Block (cooldown): 7058561
       Percentage: 0
     Block (cooldown): 7058562
       Percentage: 0
     Block (cooldown): 7058563
       Percentage: 0
     Block (cooldown): 7058564
       Percentage: 0
     Block (cooldown): 7058565
       Percentage: 0
     Block (cooldown): 7058566
       Percentage: 10
  
     Cooldown complete! Liquidation window begins:
  
     Block: 7058566
       Liquidatable %: 10
       Amount (cWBTC): 5
     Block: 7058567
       Liquidatable %: 16
       Amount (cWBTC): 8
     Block: 7058568
       Liquidatable %: 22
       Amount (cWBTC): 11
     Block: 7058569
       Liquidatable %: 28
       Amount (cWBTC): 14
     Block: 7058570
       Liquidatable %: 34
       Amount (cWBTC): 17
     Block: 7058571
       Liquidatable %: 40
       Amount (cWBTC): 20
     Block: 7058572
       Liquidatable %: 46
       Amount (cWBTC): 23
     Block: 7058573
       Liquidatable %: 52
       Amount (cWBTC): 26
     Block: 7058574
       Liquidatable %: 58
       Amount (cWBTC): 29
     Block: 7058575
       Liquidatable %: 64
       Amount (cWBTC): 32
     Block: 7058576
       Liquidatable %: 70
       Amount (cWBTC): 35
     Block: 7058577
       Liquidatable %: 76
       Amount (cWBTC): 38
     Block: 7058578
       Liquidatable %: 82
       Amount (cWBTC): 41
     Block: 7058579
       Liquidatable %: 88
       Amount (cWBTC): 44
     Block: 7058580
       Liquidatable %: 94
       Amount (cWBTC): 47
     Block: 7058581
       Liquidatable %: 100
       Amount (cWBTC): 50
  
  8. Initiating liquidation for Bob (has wallet balance)...
     Liquidation initiated at block: 7058581
  
  9. Simulating progressive liquidation window for Bob...
     Bob's wallet balance (20 WBTC) < collateral (80 cWBTC)
     Wallet/Collateral ratio: 25% -> No cap protection (< 50% threshold)
  
     Block (cooldown): 7058582
       Percentage: 0
     Block (cooldown): 7058583
       Percentage: 0
     Block (cooldown): 7058584
       Percentage: 0
     Block (cooldown): 7058585
       Percentage: 0
     Block (cooldown): 7058586
       Percentage: 0
     Block (cooldown): 7058587
       Percentage: 0
     Block (cooldown): 7058588
       Percentage: 0
     Block (cooldown): 7058589
       Percentage: 0
     Block (cooldown): 7058590
       Percentage: 0
     Block (cooldown): 7058591
       Percentage: 0
     Block (cooldown): 7058592
       Percentage: 0
     Block (cooldown): 7058593
       Percentage: 0
     Block (cooldown): 7058594
       Percentage: 0
     Block (cooldown): 7058595
       Percentage: 0
     Block (cooldown): 7058596
       Percentage: 10
  
     Cooldown complete! Liquidation window begins:
  
     Block: 7058596
       Liquidatable %: 10
       Amount (cWBTC): 8
     Block: 7058597
       Liquidatable %: 16
       Amount (cWBTC): 12
     Block: 7058598
       Liquidatable %: 22
       Amount (cWBTC): 17
     Block: 7058599
       Liquidatable %: 28
       Amount (cWBTC): 22
     Block: 7058600
       Liquidatable %: 34
       Amount (cWBTC): 27
     Block: 7058601
       Liquidatable %: 40
       Amount (cWBTC): 32
     Block: 7058602
       Liquidatable %: 46
       Amount (cWBTC): 36
     Block: 7058603
       Liquidatable %: 52
       Amount (cWBTC): 41
     Block: 7058604
       Liquidatable %: 58
       Amount (cWBTC): 46
     Block: 7058605
       Liquidatable %: 64
       Amount (cWBTC): 51
     Block: 7058606
       Liquidatable %: 70
       Amount (cWBTC): 56
     Block: 7058607
       Liquidatable %: 76
       Amount (cWBTC): 60
     Block: 7058608
       Liquidatable %: 82
       Amount (cWBTC): 65
     Block: 7058609
       Liquidatable %: 88
       Amount (cWBTC): 70
     Block: 7058610
       Liquidatable %: 94
       Amount (cWBTC): 75
     Block: 7058611
       Liquidatable %: 100
       Amount (cWBTC): 80
  
  === DEPLOYMENT COMPLETE ===
  
  Deployed Contracts:
    WBTC (Mock): 0x81a2e35Ce5730Fc0B10730A6Ecd0f890CB20012F
    cWBTC (Circuit Breaker): 0x0888091227379c6e5719859F7A39024edA454E20
    LendingProtocol: 0xE28C059f74e0044C01bD06e9B0A2642D5d1717e6
  
  Key Observations:
    1. Progressive liquidation grows from 10% to max allowed over 15 blocks
    2. Users with wallet balance get protection caps that decay over time
    3. Alice (100% ratio) starts at 50% cap, decays to 100%
    4. Bob (25% ratio) has no cap - normal progressive curve
    5. This mechanism balances user protection with protocol solvency
  

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [468612] → new MockWBTC@0x81a2e35Ce5730Fc0B10730A6Ecd0f890CB20012F
    ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: 0x823eF872d97f3Cffd1e3D491c9560EB0D3886D56, value: 1000000000000000000000 [1e21])
    └─ ← [Return] 1883 bytes of code

  [324889] → new LendingProtocol@0x5254605C60AfB2D77cbfA35E0De60467ce622BB8
    └─ ← [Return] 1511 bytes of code

  [1234708] → new CircuitBreakerToken@0x0888091227379c6e5719859F7A39024edA454E20
    └─ ← [Return] 5934 bytes of code

  [324889] → new LendingProtocol@0xE28C059f74e0044C01bD06e9B0A2642D5d1717e6
    └─ ← [Return] 1511 bytes of code

  [29684] MockWBTC::mint(0x00000000000000000000000000000000000A11cE, 100000000000000000000 [1e20])
    ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: 0x00000000000000000000000000000000000A11cE, value: 100000000000000000000 [1e20])
    └─ ← [Stop]

  [29684] MockWBTC::mint(0x0000000000000000000000000000000000000B0b, 100000000000000000000 [1e20])
    ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: 0x0000000000000000000000000000000000000B0b, value: 100000000000000000000 [1e20])
    └─ ← [Stop]

  [22550] LendingProtocol::setHealthFactor(0x00000000000000000000000000000000000A11cE, 800000000000000000 [8e17])
    └─ ← [Stop]

  [22550] LendingProtocol::setHealthFactor(0x0000000000000000000000000000000000000B0b, 900000000000000000 [9e17])
    └─ ← [Stop]

  [60864] LendingProtocol::initiateLiquidation(0x00000000000000000000000000000000000A11cE)
    ├─ [55560] CircuitBreakerToken::initiateLiquidation(0x00000000000000000000000000000000000A11cE)
    │   ├─ [2571] LendingProtocol::canLiquidate(0x00000000000000000000000000000000000A11cE) [staticcall]
    │   │   └─ ← [Return] true
    │   ├─ [2590] LendingProtocol::getUserCollateral(0x00000000000000000000000000000000000A11cE) [staticcall]
    │   │   └─ ← [Return] 0
    │   ├─ emit LiquidationInitiated(user: 0x00000000000000000000000000000000000A11cE, canLiquidateAt: 7058566 [7.058e6], windowEndsAt: 7058581 [7.058e6], maxAmount: 0)
    │   └─ ← [Stop]
    └─ ← [Stop]

  [60864] LendingProtocol::initiateLiquidation(0x0000000000000000000000000000000000000B0b)
    ├─ [55560] CircuitBreakerToken::initiateLiquidation(0x0000000000000000000000000000000000000B0b)
    │   ├─ [2571] LendingProtocol::canLiquidate(0x0000000000000000000000000000000000000B0b) [staticcall]
    │   │   └─ ← [Return] true
    │   ├─ [2590] LendingProtocol::getUserCollateral(0x0000000000000000000000000000000000000B0b) [staticcall]
    │   │   └─ ← [Return] 0
    │   ├─ emit LiquidationInitiated(user: 0x0000000000000000000000000000000000000B0b, canLiquidateAt: 7058566 [7.058e6], windowEndsAt: 7058581 [7.058e6], maxAmount: 0)
    │   └─ ← [Stop]
    └─ ← [Stop]


==========================

Chain 31

Estimated gas price: 0.025799783 gwei

Estimated total gas used for script: 4091473

Estimated amount required: 0.000105559115550359 tRBTC

==========================

##### rsk-testnet
✅  [Success] Hash: 0x4b468a9ebd56f207eb2d435e67b7cfc9d0f4b952d23d892ff3c84e14bd7e5bde
Contract Address: 0x5254605C60AfB2D77cbfA35E0De60467ce622BB8
Block: 7058553
Gas Used: 402211


##### rsk-testnet
✅  [Success] Hash: 0x7ac9b83ab503d6d34980548bc1816d2032f5649a9f33c44160e36c80eae6c185
Contract Address: 0x0888091227379c6e5719859F7A39024edA454E20
Block: 7058553
Gas Used: 1389888


##### rsk-testnet
✅  [Success] Hash: 0x8a9027a3ac1715e42d8237e7a89324b0d3cffbadf96f253b150727b0b2cc38d6
Contract Address: 0x81a2e35Ce5730Fc0B10730A6Ecd0f890CB20012F
Block: 7058553
Gas Used: 558308


##### rsk-testnet
✅  [Success] Hash: 0x2b6602ca3db6863d13204100338356846e2acedb1e8abab362167b3374c4686b
Block: 7058553
Gas Used: 41866


##### rsk-testnet
✅  [Success] Hash: 0x8823a21048b5d2c3438addf30cfa37c005061fb36ca46c16b2bd10a1c71d4c37
Contract Address: 0xE28C059f74e0044C01bD06e9B0A2642D5d1717e6
Block: 7058553
Gas Used: 402439


##### rsk-testnet
✅  [Success] Hash: 0xf2b8b876d0028201a3acdd25dc41a7d334324cd156196a4e2c3e8f96fe3e9587
Block: 7058553
Gas Used: 41878


##### rsk-testnet
✅  [Success] Hash: 0xcb699aad3ea14fd03c18e0856de87d76f419b6d564208caa48a45356daf22080
Block: 7058553
Gas Used: 49424


##### rsk-testnet
✅  [Success] Hash: 0x0f47b88ea0f4d3d3862c2e135add0c8cab36bbfc206199f5053ec86e8512db19
Block: 7058553
Gas Used: 75692


##### rsk-testnet
✅  [Success] Hash: 0xa627c0e451b17419c8bbd643954d2f9a0c10b39fe74bcd0a5733733e7806e359
Block: 7058553
Gas Used: 49412


##### rsk-testnet
✅  [Success] Hash: 0x795b176c1787d4f644e7f18f0216224436ee2576018e3b1770b4793609acf6b9
Block: 7058553
Gas Used: 75680

✅ Sequence #1 on rsk-testnet | Total Paid: 0. tRBTC (3086798 gas * avg 0 gwei)
                                                                                                  

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.

Transactions saved to: /Users/jordan/circuit-breaker-token/broadcast/CircuitBreakerToken.s.sol/31/run-latest.json

Sensitive values saved to: /Users/jordan/circuit-breaker-token/cache/CircuitBreakerToken.s.sol/31/run-latest.json
